/**********************************************************************************************************************
 *  FILE DESCRIPTION
 *  -----------------------------------------------------------------------------------------------------------------*/
/**        \file  CPU.c
 *        \brief  The source file for the CPU Driver
 *
 *      \details  NULL
 *
 *
 *********************************************************************************************************************/

/**********************************************************************************************************************
 *  INCLUDES
 *********************************************************************************************************************/
#include "CPU.h"

/**********************************************************************************************************************
*  LOCAL MACROS CONSTANT\FUNCTION
*********************************************************************************************************************/
#define CPU_MODE_PRIVILEGED     0
#define CPU_MODE_USER           1
/**********************************************************************************************************************
 *  LOCAL DATA 
 *********************************************************************************************************************/
static uint8_t CPU_Mode = CPU_MODE_PRIVILEGED;
/**********************************************************************************************************************
 *  GLOBAL DATA
 *********************************************************************************************************************/
 
/**********************************************************************************************************************
 *  LOCAL FUNCTION PROTOTYPES
 *********************************************************************************************************************/

/**********************************************************************************************************************
 *  LOCAL FUNCTIONS
 *********************************************************************************************************************/
void SVC_Handler(void)
{
   switch(CPU_Mode)
   {
   case CPU_MODE_PRIVILEGED:
     __asm ("MRS R1, CONTROL");
     __asm ("AND R1, #0xfffffffe");
     __asm ("MSR CONTROL, R1");
     break;
   case CPU_MODE_USER:
     __asm ("MRS R1, CONTROL");
     __asm ("AND R1, #0xfffffffe");
     __asm ("ORR R1, #1");      
     __asm ("MSR CONTROL, R1");
     break;
   default:
     break;
   }
}
/**********************************************************************************************************************
 *  GLOBAL FUNCTIONS
 *********************************************************************************************************************/
void CPU_SwitchToPrivilegedMode(void)
{
  CPU_Mode = CPU_MODE_PRIVILEGED;
  __asm ("SVC #1");
}
void CPU_SwitchToUserMode(void)
{
  CPU_Mode = CPU_MODE_USER;
  __asm ("SVC #1");
}
/******************************************************************************
* \Syntax          : Std_ReturnType FunctionName(AnyType parameterName)        
* \Description     : Describe this service                                    
*                                                                             
* \Sync\Async      : Synchronous                                               
* \Reentrancy      : Non Reentrant                                             
* \Parameters (in) : parameterName   Parameter Describtion                     
* \Parameters (out): None                                                      
* \Return value:   : Std_ReturnType  E_OK
*                                    E_NOT_OK                                  
*******************************************************************************/
/*Std_ReturnType FunctionName(AnyType parameterName)
{
	
	
}*/

/**********************************************************************************************************************
 *  END OF FILE: FileName.c
 *********************************************************************************************************************/
